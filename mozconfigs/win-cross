CROSS_BUILD=1

ARCH=${ARCH:x64}

if [ "$ARCH" = "x64" ]; then
  ac_add_options --target=x86_64-pc-mingw32
else
  ac_add_options --target=i686-pc-mingw32
fi

# win-cross contains:
#
#  * vs: Generated using ./mach python --virtualenv build build/vs/pack_vs.py build/vs/vs2019.yaml -o vs.tar.zst
#  * liblowercase: .so built from build/liblowercase
#
# Note that you need the msitools package for the mach command above to
# succeed.
export WINDOWSSDKDIR="$MOZBUILD/win-cross/vs/windows kits/10"

# TODO: Use a loop vfat device instead of this?
mk_add_options "export LD_PRELOAD=$MOZBUILD/win-cross/liblowercase/liblowercase.so"
mk_add_options "export LOWERCASE_DIRS=$MOZBUILD/win-cross"

EXTRA_PATH="$MOZBUILD/win-cross/vs/vc/tools/msvc/14.29.30133/bin/hostx64/$ARCH:"

mk_add_options "export PATH=$EXTRA_PATH$PATH"

export CC="$MOZBUILD/clang/bin/clang-cl"
export CXX="$MOZBUILD/clang/bin/clang-cl"
export HOST_CC="$MOZBUILD/clang/bin/clang"
export HOST_CXX="$MOZBUILD/clang/bin/clang++"

# Other things needed for packaging:
#  * 7z needs to be on your PATH, or specified with export 7Z
